package config;

import net.sf.ehcache.Cache;
import net.sf.ehcache.CacheManager;
import net.sf.ehcache.Element;
import org.springframework.jdbc.core.JdbcTemplate;

import java.util.*;

public class CacheInit {

    private static final String sql = "SELECT t.dict_code||'_'||t.code key , t.value value FROM sys_subdict t WHERE t.sfyx_st = '1'";

    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
    }

    private JdbcTemplate jdbcTemplate;

    public void init(){
        List<Map<String, Object>> dictlist = jdbcTemplate.queryForList(sql);
        CacheManager cacheManager = CacheManager.getInstance();
        Cache cache = cacheManager.getCache(net.ruixin.util.cache.Cache.CONSTANT);
        cache.putAll(toElement(dictlist));
    }

    private Collection<Element> toElement(List<Map<String, Object>> dictlist) {
        Set<Element> set = new HashSet();
        for (Map map : dictlist){
            set.add(new Element(map.get("key"),map.get("value")));
        }
        return set;
    }
}
